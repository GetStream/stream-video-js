<div class="container">
  <div class="start-call">
    <button mat-flat-button color="primary" [disabled]="joinOrCreate === 'join' && !callMeta" (click)="startCall()">{{joinOrCreate === 'create' ? 'Start a call' : 'Join call'}}</button>
    <div *ngIf="joinOrCreate === 'create'">You will be able to invite people once the call starts</div>
    <div *ngIf="joinOrCreate === 'join'">
      Already in this call: TODO not yet supported
    </div>
  </div>
  <div class="device-settings">
    <div class="video-container" [class.no-video]="videoState === 'off'" [ngSwitch]="videoState">
      <video *ngSwitchCase="'on'" autoplay [srcObject]="videoStream"></video>
      <div class="error" *ngSwitchCase="'error'">
        {{ videoErrorMessage }}
      </div>
      <div *ngSwitchCase="'loading'" class="loading">
        <mat-progress-spinner
          color="primary"
          diameter="50"
          mode="indeterminate"
        ></mat-progress-spinner>
      </div>
      <div class="video-off off" *ngSwitchCase="'off'">Camera turned off</div>
      <ng-container *ngIf="videoState !== 'loading'">
        <div [ngSwitch]="audioState" class="audio-state">
          <div *ngSwitchCase="'on'">
            <mat-icon class="mic" [class.speaking]="isSpeaking" fontIcon="mic"></mat-icon>
          </div>
          <div class="error" *ngSwitchCase="'error'">
            {{ audioErrorMessage }}
          </div>
          <div *ngSwitchCase="'loading'" class="loading">
            <mat-progress-spinner
              color="primary"
              diameter="20"
              mode="indeterminate"
            ></mat-progress-spinner>
          </div>
          <div class="mic off" *ngSwitchCase="'off'"><mat-icon fontIcon="mic_off"></mat-icon></div>
        </div>
      </ng-container>
    </div>
    <app-device-control></app-device-control>
  </div>
</div>
