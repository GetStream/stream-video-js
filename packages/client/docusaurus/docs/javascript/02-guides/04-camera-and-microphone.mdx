---
id: camera-and-microphone
title: Camera & Microphone
description: Managing audio and video
---

The video client exports helper methods to make it easier to work with the [`MediaStream`](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream) and [`MediaDeviceInfo`](https://developer.mozilla.org/en-US/docs/Web/API/MediaDeviceInfo) APIs.

## Camera management

### Call settings

The call settings contain information about the default video state:

```typescript
call.state.settings$.subscribe((settings) => {
  console.log(settings?.video.camera_default_on);
});
```

### Start-stop camera

```typescript
import { getVideoStream, SfuModels } from '@stream-io/video-client';

const toggleCamera = () => {
  const { localParticipant } = call.state;
  if (!localParticipant) return;
  if (localParticipant.publishedTracks.includes(SfuModels.TrackType.VIDEO)) {
    // This will take care of disposing the media stream
    await call.stopPublish(SfuModels.TrackType.VIDEO);
  } else {
    const videoStream = await getVideoStream();
    await call.publishVideoStream(videoStream);
  }
};
```

### List and select devices

```typescript
import { getVideoStream, getVideoDevices } from '@stream-io/video-client';

// List devices
// The error handler is called if the user denies permission to use camera
getVideoDevices().subscribe({
  next: (cameras) => console.log(cameras),
  error: (err) => console.error(err),
});

// Select device and store selected device for participant
call.setVideoDevice('device Id');

// Take a video stream
const videoStream = await getVideoStream({ deviceId: 'device Id' });
```

### Lobby preview

Here is how to setup a video preview displayed before joining the call:

```typescript
TODO example
```

## Microphone management

### Call settings

The call settings contain information about the default audio state:

```typescript
call.state.settings$.subscribe((settings) => {
  console.log(settings?.audio.mic_default_on);
});
```

### Start-stop microphone

```typescript
const toggleMicrophone = () => {
  const { localParticipant } = call.state;
  if (!localParticipant) return;
  if (localParticipant.publishedTracks.includes(SfuModels.TrackType.AUDIO)) {
    // This will take care of disposing the media stream
    await call.stopPublish(SfuModels.TrackType.AUDIO);
  } else {
    const audioStream = await getAudioStream();
    await call.publishAudioStream(audioStream);
  }
};
```

### List and select devices

```typescript
import { getAudioStream, getAudioDevices } from '@stream-io/video-client';

// List devices
// The error handler is called if the user denies permission to use microphone
getAudioDevices().subscribe({
  next: (mics) => console.log(mics),
  error: (err) => console.error(err),
});

// Select device and store selected device for participant
call.setAudioDevice('device Id');

// Take an audio stream
const audioStream = await getAudioStream({ deviceId: 'device Id' });
```

For more information you can refer to [this codesandbox](https://codesandbox.io/s/javascript-device-management-forked-cv47gr?file=/src/index.ts) that shows how you can select audio and video devices.

## Speaker management

### Browser support

Selecting audio output device for the call [isn't supported by all browsers](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/sinkId), this is how you can check the availability:

```typescript
import { checkIfAudioOutputChangeSupported } from '@stream-io/video-client';

checkIfAudioOutputChangeSupported();
```

### List and select devices

```typescript
import { getAudioOutputDevices } from '@stream-io/video-client';

// List devices
// The error handler is called if the user denies permission to use play audio through device's speakers
getAudioOutputDevices().subscribe({
  next: (speakers) => console.log(speakers),
  error: (err) => console.error(err),
});

// store selected device for participant
call.setAudioOutputDevice('device Id');
```

To apply the changes you need to set the [sinkId](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/sinkId) property of the `audio` elements to the selected audio output device.

## Advanced

### Device unavailability

It may happen, that we would like to react to a situation, when there is no device of a given kind (audio, video) available. This can for example happen, when a laptop lid is closed. In that case we may want to disable the given device kind for the next time, when the lid is re-opened.

```typescript
import {
  Call,
  SfuModels,
  watchForDisconnectedAudioDevice,
  watchForDisconnectedVideoDevice,
} from '@stream-io/video-client';

const call: Call;

watchForDisconnectedAudioDevice(
  call.state.localParticipant$.map((p) => p?.audioDeviceId),
).subscribe(() => {
  call.stopPublish(SfuModels.TrackType.AUDIO);
});

watchForDisconnectedVideoDevice(
  call.state.localParticipant$.map((p) => p?.videoDeviceId),
).subscribe(() => {
  call.stopPublish(SfuModels.TrackType.VIDEO);
});
```

### Sound detection

An important topic related to media devices management is sound detection. A feature often needed in a call scenario (volume detection, speaking-while-muted notification). We can start detecting the audio input level changes using the utility function [`createSoundDetector`](https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts). The function requires an instance of [`MediaStream`](https://developer.mozilla.org/en-US/docs/Web/API/MediaStream) object of type `audioinput` and attaches sound analysers to it. The `MediaStream` can be retrieved by the client's `getAudioStream` utility function. Then it periodically collects audio frequency data. We can access this data by providing the `onSoundDetectedStateChanged` callback function. The callback function will be passed and object of type [`SoundDetectorState`](https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts) as argument. From the object we can extract the information about the audio level (`audioLevel`) or a more simplified general flag that tells us, whether sound was detected (`isSoundDetected`).

It is also possible to configure the data collection algorithm with the third [`options` parameter](https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts).

The return value of [`createSoundDetector`](https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts) function is a clean-up function.
