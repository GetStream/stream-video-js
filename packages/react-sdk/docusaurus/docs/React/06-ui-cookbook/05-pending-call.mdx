---
id: pending-call
title: Pending Call
description: Pending Call
---

When building an application that relies on [`ring call workflow`](../../guides/call-lifecycle#ring-call), you'll often want to build your own incoming or outgoing call panels. The React SDK already comes with a pre-built [`PendingCallPanel`](todo docs link) component. However, in this article we will build a new one from scratch.

The component will render:

1. Call controls buttons to toggle audio and video enablement and accept resp. reject call buttons
2. Avatars of called users or the current user's video preview
3. Call calling state indicator

## Project setup and prerequisites

Make sure you have the following prerequisites checked:

1. [Registered Stream account](https://getstream.io/try-for-free/)
2. Have an app created in the [Stream's dashboard](https://dashboard.getstream.io/) to obtain app API key and secret.
3. Initiate the project (you can follow our [introductory tutorial setup guide](../../tutorials/video-calling#set-up-for-success))
4. Have installed the Stream video and chat SDKs in the project:

```shell
npm install @stream-io/video-react-sdk stream-chat-react stream-chat
```

```shell
yarn add @stream-io/video-react-sdk stream-chat-react stream-chat
```

## App boilerplate
In order we can start performing calls we need a `StreamVideoClient` instance connected to the Stream's server network with app credentials. For more information on how to do that, please take a look at our [authentication guide](../../guides/client-auth#setting-up-a-streamvideoclient-and-connecting-a-user).

## Pending call panel implementation
The component will rely on data accessed via our utility hooks:

- [`useCall`](../../call-engine/hooks-and-contexts#usecall)
- [`useCallCallingState`](../../call-engine/hooks-and-contexts#usecallcallingstate)
- [`useCallMetadata`](../../call-engine/hooks-and-contexts#usecallmetadata)
- [`useCallMembers`](../../call-engine/hooks-and-contexts#usecallmembers)
- [`useMediaDevices`](../../call-engine/hooks-and-contexts#usemediadevices)

### User preview

The panel will render [`VideoPreview`](todo docs link) so that the user can see the camera input or avatars if video preview is disabled. The avatar display logic is as follows:
- show all the called users' avatars if the call is outgoing (who am I calling)
- show the avatar of the person who initiated the call in case of an incoming call (who is calling me)

:::note
Note, how the initial video state is handled by [`MediaDevicesProvider`](../../call-engine/hooks-and-contexts#mediadevicesprovider). We only consume the API through corresponding context consumer hook [`useMediaDevices`](../../call-engine/hooks-and-contexts#usemediadevices).
:::
```tsx
import {
  useCall,
  useCallMembers,
  useCallMetadata,
  useMediaDevices,
} from '@stream-io/video-react-sdk';

type PendingCallPanelProps = {
  showMemberCount?: number;
};

export const CustomPendingCallPanel = ({
  showMemberCount = 3,
}: PendingCallPanelProps) => {
  const call = useCall();
  const metadata = useCallMetadata();
  const members = useCallMembers();
  // highlight-next-line
  const { initialVideoState } = useMediaDevices();

  if (!call) return null;

  const caller = metadata?.created_by;
  // show the caller if this is an incoming call or show all the users I am calling to
  const membersToShow = call.isCreatedByMe
    ? members
        ?.slice(0, showMemberCount)
        .map(({ user }) => user)
        .filter((u) => !!u) || []
    : caller
    ? [caller]
    : [];

  return (
    <div className="str-video__call-panel str-video__call-panel--pending">
      // highlight-next-line
      {initialVideoState.enabled ? (
        <VideoPreview />
      ) : (
        <CallMembers members={membersToShow} />
      )}
      <CallCallingStateLabel />
      <CallControls />
    </div>
  );
};
```

#### Video preview enablement

Enable the initial video in [`VideoPreview`](todo docs link) component with `mediaDevicesProviderProps` prop on [`StreamCall`](todo docs link) component as follows:

```tsx
import { StreamCall, useCalls } from '@stream-io/video-react-sdk';

import { CallPanel } from './CallPanel';

export const Video = () => {
  const calls = useCalls();
  return (
    <>
      {calls.map((call) => (
        <StreamCall
          call={call}
          autoJoin={false}
          key={call.cid}
          // highlight-next-line
          mediaDevicesProviderProps={{ initialVideoEnabled: true }}
        >
          <CallPanel />
        </StreamCall>
      ))}
    </>
  );
};
```

Or, if instead of using [`StreamCall`](todo docs link), we want to use the [`MediaDevicesProvider`](../../call-engine/hooks-and-contexts#mediadevicesprovider) component directly, we pass `initialVideoEnabled` value to it as follows:

```tsx
import {MediaDevicesProvider} from "@stream-io/video-react-sdk";

const SomeComponent = () => {
    return (
        ...
        <MediaDevicesProvider initialVideoEnabled>
          ...
        </MediaDevicesProvider>
        ...
    )
}
```

#### User avatars

We display relevant users' avatars with `CallMembers` component.

```tsx
import {
  UserResponse
} from '@stream-io/video-react-sdk';

type CallMembersProps = {
  members: UserResponse[];
};
const CallMembers = ({ members }: CallMembersProps) => {
  return (
    <div className="str-video__call-panel__members-list">
      {members.map((member) => (
        <div key={member.id} className="str-video__call-panel__member-box">
          <Avatar name={member.name} imageSrc={member.image} />
          {member.name && (
            <div className="str-video__member_details">
              <span className="str-video__member_name">{member.name}</span>
            </div>
          )}
        </div>
      ))}
    </div>
  );
};
```

### Call calling state label

To show to our users the state of call connection, we implement `CallCallingStateLabel`. The calling state is provided by [`useCallCallingState`](../../call-engine/hooks-and-contexts#usecallcallingstate) hook:


:::note
In this component we are using translation service that comes bundled with the SDK. The service API is consumed with [`useI18n`](../../call-engine/hooks-and-contexts#usei18n) hook. Lean more about using the [i18n service in the dedicated documentation](../../advanced/i18n).
:::
```tsx
import {
  CallingState,
  useCallCallingState,
  useI18n,
} from '@stream-io/video-react-sdk';

const CALLING_STATE_TO_LABEL: Record<CallingState, string> = {
  [CallingState.JOINING]: 'Joining',
  [CallingState.RINGING]: 'Ringing',
  [CallingState.RECONNECTING]: 'Re-connecting',
  [CallingState.RECONNECTING_FAILED]: 'Failed',
  [CallingState.OFFLINE]: 'No internet connection',
  [CallingState.IDLE]: '',
  [CallingState.UNKNOWN]: '',
  [CallingState.JOINED]: 'Joined',
  [CallingState.LEFT]: 'Left call',
};

const CallCallingStateLabel = () => {
  const { t } = useI18n();
  const callingState = useCallCallingState();
  const callingStateLabel = CALLING_STATE_TO_LABEL[callingState];

  return callingStateLabel ? (
    <div className="str-video__call-panel__calling-state-label">
      {t(callingStateLabel)}
    </div>
  ) : null;
};
```

### Call controls

Finally, we build the call control buttons. We include buttons to toggle camera and microphone and buttons to accept and reject the call.

:::note
The toggle video and audio buttons are just wrappers around pre-built button components attaching click handlers provided by [`MediaDevicesProvider`](../../call-engine/hooks-and-contexts#mediadevicesprovider).
:::
```tsx
import {
  useCall,
  CallingState,
  useCallCallingState,
  useMediaDevices,
} from '@stream-io/video-react-sdk';

const CallControls = () => {
  const call = useCall();
  const callingState = useCallCallingState();

  if (!call) return null;
  // show pending call panel components only before the call is joined
  if (![CallingState.RINGING, CallingState.JOINING].includes(callingState))
    return null;

  // prevent users from rejecting call when already accepted
  const buttonsDisabled = callingState === CallingState.JOINING;

  return (
    <div className="str-video__pending-call-controls">
      <ToggleAudioButton />
      <ToggleVideoButton />
      {call.isCreatedByMe ? (
        <CancelCallButton call={call} disabled={buttonsDisabled} />
      ) : (
        <>
          <AcceptCallButton call={call} disabled={buttonsDisabled} />
          <CancelCallButton
            onClick={() => call.leave({ reject: true })}
            disabled={buttonsDisabled}
          />
        </>
      )}
    </div>
  );
};

const ToggleAudioButton = () => {
  const { initialAudioEnabled, toggleInitialAudioMuteState } =
    useMediaDevices();

  return (
    <IconButton
      icon={initialAudioEnabled ? 'mic' : 'mic-off'}
      onClick={toggleInitialAudioMuteState}
    />
  );
};

const ToggleVideoButton = () => {
  const { toggleInitialVideoMuteState, initialVideoState } = useMediaDevices();

  return (
    <IconButton
      icon={initialVideoState.enabled ? 'camera' : 'camera-off'}
      onClick={toggleInitialVideoMuteState}
    />
  );
};
```
