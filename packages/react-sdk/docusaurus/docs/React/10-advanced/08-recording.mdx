---
id: recording
title: Recording
description: Recording
---

One highly sought-after feature in many communication applications is call recording. Whether it's for legal compliance, quality assurance, or simply for future reference, the ability to record calls is essential in numerous scenarios.

This documentation article serves as a guide for implementing a call recording feature in your application. We will explore the technical aspects and best practices involved in capturing and storing recording data during calls.

## Recording calls
The [`Call`](../../call-engine/call) objects exposes the call recording API. To start recording, we simply invoke `call.startRecording()`. To stop recording, we use `call.stopRecording()`.
To determine, whether a call recording is in progress, we use [`useIsCallRecordingInProgress`](../../call-engine/hooks-and-contexts#useiscallrecordinginprogress) hook. This may serve us well, when we want to provide visual clues about the recording state. We have to be aware, that it can take few moments until a call recording starts. We recommend to keep own state signalling that the call recording is starting, but has not begun yet.

```tsx
import { useCallback, useEffect, useState } from 'react';
import {
  useCall,
  useIsCallRecordingInProgress,
} from '@stream-io/video-react-bindings';

import { LoadingIndicator } from '../LoadingIndicator';

export const CustomCallRecordButton = () => {
  const call = useCall();
  const isCallRecordingInProgress = useIsCallRecordingInProgress();
  const [isAwaitingResponse, setIsAwaitingResponse] = useState(false);

  useEffect(() => {
    // we wait until call.recording_started/stopped event to flips the
    // `isCallRecordingInProgress` state variable.
    // Once the flip happens, we remove the loading indicator
    setIsAwaitingResponse((isAwaiting) => {
      if (isAwaiting) return false;
      return isAwaiting;
    });
  }, [isCallRecordingInProgress]);

  const toggleRecording = useCallback(async () => {
    try {
      setIsAwaitingResponse(true);
      if (isCallRecordingInProgress) {
        await call?.stopRecording();
      } else {
        await call?.startRecording();
      }
    } catch (e) {
      console.error(`Failed start recording`, e);
    }
  }, [call, isCallRecordingInProgress]);

  return (
    isAwaitingResponse
      ? <LoadingIndicator />
      : <button onClick={ toggleRecording } >{/* Button content */}</button>
  );
};
```

### Permissions
To start and stop recording, the user has to have corresponding permissions. We therefore encourage the integrators to check the permissions before allowing users to execute a given action. The SDK bundles component [`Restricted`](https://github.com/GetStream/stream-video-js/tree/main/packages/react-sdk/src/wrappers/Restricted) that renders its children only if the user has sufficient permissions. The SDK's [`RecordCallButton`](../../ui-components/call-controls#recordcallbutton) makes use of the [`Restricted`](https://github.com/GetStream/stream-video-js/tree/main/packages/react-sdk/src/wrappers/Restricted) component.

To learn more about permissions, take a look at our [permissions guide](../../guides/permissions-and-moderation).

### Call recording SDK components
The React SDK comes with [`RecordCallButton`](../../ui-components/call-controls#recordcallbutton), that takes care of initiating the call recording.

## Acquiring call recordings data
The call recording data can be retrieved by calling the [`Call`](../../call-engine/call) method `queryRecordings()`. By default, it retrieves all the call recordings for a given call (call CID). However, it accepts a single argument `callSessionId` that allows us to retrieve only recordings done during a single call session. The method returns `ListRecordingsResponse` that carries an array of `CallRecording` objects accessible through `recordings` key.

:::note
Multiple calls can be recorded during a single call session, but a single call CID can be reused for multiple sessions, too.
:::

With every call to `call.queryRecordings()`, the call state is updated with the latest array of `CallRecording` objects. The latest value is then always emitted through the `useCallRecordings` hook.

:::warning
The call recording list has to be queried explicitly and is not automatically updated at any stage of a call.
:::

If we wanted to keep and up-to-date list of call recordings during an active call, we would need to query them at the start of the call as well as with every [`call.recording_stopped` event](../events).

:::note
The call recording is not immediately available when the `call.recording_stopped` event is delivered. It may take 30 or more seconds for a recording to be available. Therefore, polling mechanism has to be introduced to check, whether the latest list of call recordings returned from the query contains a new item.
:::

```tsx
import { forwardRef, useEffect, useRef, useState } from 'react';
import {
  CallRecording,
  CallRecordingList,
  IconButton,
  MenuToggle,
  ToggleMenuButtonProps,
  useCall,
  useCallRecordings,
  useStreamVideoClient,
} from '@stream-io/video-react-sdk';

const MAX_NUMBER_POLL_REQUESTS = 6;
const POLL_INTERVAL_MS = 10 * 1000;

export const CallRecordings = () => {
  const callRecordings = useCallRecordings();
  const client = useStreamVideoClient();
  const activeCall = useCall();

  const [loadingCallRecordings, setLoadingCallRecordings] = useState(false);
  const recordingPollRequestsCount = useRef(0);
  const recordingPollRequestsInterval = useRef<
    ReturnType<typeof setInterval> | undefined
  >();

  useEffect(() => {
    if (!(client && activeCall && callRecordings)) return;

    const scheduleCallRecordingPolling = () => {
      setLoadingCallRecordings(true);

      if (recordingPollRequestsInterval.current) {
        clearInterval(recordingPollRequestsInterval.current);
      }

      recordingPollRequestsInterval.current = setInterval(async () => {
        let recordings: CallRecording[] = [];
        try {
          const response = await activeCall.queryRecordings();
          recordings = response.recordings;
        } catch (e) {
          console.error('Failed to query recordings', e);
        } finally {
          recordingPollRequestsCount.current++;
          const hasNewRecordings = callRecordings.length < recordings.length;

          if (
            recordingPollRequestsCount.current === MAX_NUMBER_POLL_REQUESTS ||
            hasNewRecordings
          ) {
            clearInterval(recordingPollRequestsInterval.current);
            setLoadingCallRecordings(false);
          }
        }
      }, POLL_INTERVAL_MS);
    };

    // register a polling mechanism once the recording has been stopped
    client.on('call.recording_stopped', scheduleCallRecordingPolling);

    return () => {
      client.off('call.recording_stopped', scheduleCallRecordingPolling);
    };
  }, [client, activeCall, callRecordings]);

  return (
    <MenuToggle placement="bottom-end" ToggleButton={ToggleMenuButton}>
     {/* Display recordings data in a list */}
      <CallRecordingList
        callRecordings={callRecordings}
        loading={loadingCallRecordings}
      />
    </MenuToggle>
  );
};

const ToggleMenuButton = forwardRef<HTMLButtonElement, ToggleMenuButtonProps>(
  ({ menuShown }, ref) => {
    return (
      <IconButton
        icon="call-recordings"
        ref={ref}
        title={menuShown ? 'Close' : 'Call recordings'}
      />
    );
  },
);
```

## Call recording listing SDK components
The React SDK provides [`CallRecordingList`](../../ui-components/call/call-recording-list) component to display call recordings.
