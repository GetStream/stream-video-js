---
title: Calling with Chat Tutorial
---

This document explains how to integrate Stream Chat with Stream Video to support Video/Audio Calling in your Chat Application.

To get started with the guide, ensure you have set up your [development environment for React Native](https://reactnative.dev/docs/environment-setup). Stream Chat supports creating applications using Expo and React Native CLI. But Stream Video currently only supports React Native CLI, so we will only focus on React Native CLI in this documentation.

After the app setup, follow [React Native Chat Tutorial](https://getstream.io/chat/react-native-chat/tutorial/) first and get a basic chat application ready in your app. You can customise your application according to your needs and business ideas. Follow our [React Native Chat Official Documentation](https://getstream.io/chat/docs/sdk/reactnative/) for this.

Finally, let's get started with the Stream React Native Video integration. To do this, we will first install the dependencies.

### Installation

Install Stream's Video SDK and its peer dependencies by:

```bash
yarn add stream-video-react-native react-native-webrtc react-native-incall-manager react-native-svg text-encoding-polyfill
```

Some dependencies require us to make changes to our application for all functionalities to be available. Please apply the following steps:

- `react-native-webrtc` installation on [Android](https://github.com/react-native-webrtc/react-native-webrtc/blob/master/Documentation/AndroidInstallation.md) and [iOS](https://github.com/react-native-webrtc/react-native-webrtc/blob/master/Documentation/iOSInstallation.md).
- `react-native-svg` be aware of [compatibility](https://github.com/software-mansion/react-native-svg#supported-react-native-versions) with RN versions and [troubleshooting](https://github.com/software-mansion/react-native-svg#troubleshooting) steps.
- `react-native-incall-manager` installation on [Android](https://github.com/react-native-webrtc/react-native-incall-manager#android) and [iOS](https://github.com/react-native-webrtc/react-native-incall-manager#ios).
- `react-native-callkeep` installation on [Android](https://github.com/react-native-webrtc/react-native-callkeep/blob/master/docs/android-installation.md) and [iOS](https://github.com/react-native-webrtc/react-native-callkeep/blob/master/docs/ios-installation.md).

Add the following imports and statements to your `index.js` file in the project's root.

```tsx
/** URL polyfill */
import 'text-encoding-polyfill';
/** Text decoder polyfill */
import 'react-native-url-polyfill/auto';
/** crypto.getRandomValues polyfill for uuid */
import 'react-native-get-random-values';
import {registerGlobals} from 'react-native-webrtc';
...

// Add this
if (Platform.OS !== 'web') {
  registerGlobals();
}
```

### Create `StreamVideoClient`

Firstly we need to authenticate the Video SDKâ€™s Client. You will need a user and token to authenticate a client. You can use the `client` from the Chat SDK to create the user object. To do this, you can import the hook, `useChatContext`, and use the `client` from it, as in the example below.

```tsx
import { useChatContext } from 'stream-chat-react-native';

// Inside the component
const { client } = useChatContext();

const user = useMemo<VideoProps['user']>(
  () => ({
    id: client.user?.id as string,
    name: client.user?.name as string,
    role: client.user?.role as string,
    imageUrl: client.user?.image as string,
    teams: [],
    customJson: new Uint8Array(),
  }),
  [client.user],
);
```

To create the token, you can use the same client imported above and use the `_getToken` method to fetch the token:

```tsx
const token = client._getToken() || `Your Token`;
```

Once the user object and token are created, we can authenticate the client. In the starter kit, we have created a hook which takes in the user object and the token and returns the `client` from it.

```tsx
import {StreamVideoClient} from '@stream-io/video-client';
...

const APIParams = {
  apiKey: `Your Key`
};

const client = new StreamVideoClient(APIParams.apiKey, {
  sendJson: true,
  token,
});
```

### Connecting and disconnecting from the video client

We will connect to the Stream's client instance we've created right after the component has mounted. When the component un-mounts, we will disconnect from the client.

_Note: We will use API key, user and the token from above._

```tsx
import React, {useEffect, useState} from 'react';
import {ActivityIndicator, SafeAreaView, StyleSheet, Text} from 'react-native';
...

const App = () => {
  const [connected, setConnected] = useState(false);
  const [error, setError] = useState(undefined);

  useEffect(() => {
    const run = async () => {
      try {
        await client.connect(APIParams.apiKey, token, user);
        setConnected(true);
      } catch (err) {
        setError(`Failed to establish connection - ${err}`);
      }
    };
    run();
    return () => {
      client.disconnect();
    };
  }, []);

  if (!connected) {
    return (
      <SafeAreaView style={{ flex: 1 }}>
        <ActivityIndicator size={'large'} style={StyleSheet.absoluteFill} />
      </SafeAreaView>
    );
  }

  return !error ? (
    <SafeAreaView style={{ flex: 1 }}>
      <Text>We're connected now and ready to go ðŸš€</Text>
    </SafeAreaView>
  ) : (
    <Text>{error}</Text>
  );
};
```

### Providing the video client and Call logic to the rest of the app

Our `StreamVideo` component will provide our recently created video client to the rest of the underlying components.

The `client` created above can be used as follows and needs to be provided to the `client` prop of the `StreamVideo` component.

_Note: Make sure to wrap your entire application in `StreamVideo`._

To enable calling in the application, you must wrap the `StreamCall` component on top of the navigator flows. The `StreamCall` component expects handlers on what should happen when a call is accepted, on starting an outgoing call and on receiving an incoming call.

_Note: The `StreamCall` component must be a child of the `StreamVideo` component._

```tsx
import React from 'react';
import {StreamMeeting, StreamCall } from '@stream-io/video-react-native-sdk';
...

const App = () => {
  ...
  return (
    <StreamVideo client={client}>
      <StreamMeeting
        onAcceptCall={() => navigation.navigate('ActiveCallScreen')}
        onOutgoingCall={() => navigation.navigate('OutgoingCallScreen')}
        onIncomingCall={() => navigation.navigate('IncomingCallScreen')}>
        {children}
      </StreamMeeting>
    </StreamVideo>
  );
};

```

_Note: In our example, we navigate to particular screens where we render the `IncomingCallView`, `OutgoingCallView` and `ActiveCall` components. This is done using the package [react-navigation](http://reactnavigation.org/)._

### Creating the call

To create/start a call, you can use the `createCall` function provided by the video client. This expects `callId`, `type` and `input` for the call. The `input` field expects the `ring` as `true` and the `members` to whom we want to call. An example of the usage is shared below:

```tsx
import React, {useCallback} from 'react';
import {useStreamVideoClient} from '@stream-io/video-react-native-sdk';
...

export default () => {
	const videoClient = useStreamVideoClient();

	const joinCallHandler = useCallback(() => {
	  if (videoClient) {
	    try {
	      videoClient?.createCall({
	        id: callID,
	        type: 'default',
	        input: {
	          ring: true,
	          members: members.map((memberId) => {
	            return {
	              userId: memberId,
	              role: 'member',
	              customJson: new Uint8Array(),
	            };
	          }),
	        },
	      });
	    } catch (error) {
	      console.log('Failed to createCall', callID, 'default', error);
	    }
	  }
	}, [videoClient, members]);
}
```

_Note: In our application, we derive the `members` from `channel.state?.members`._

### Rendering the Active call view

To render the active call view, you can import `ActiveCall` component from the Video SDK and use it in the Screen/View where you want to render it. This component expects two handlers to deal with the case of what should happen when the call is hanged up(`onHangupCall`) or when user clicks on the Participants View icon(`onOpenCallParticipantsInfoView`).

```tsx
import React from 'react';
import { ActiveCall, useActiveCall } from '@stream-io/video-react-native-sdk';
import { ActivityIndicator, StyleSheet } from 'react-native';

export const ActiveCallScreen = ({ navigation }: Props) => {
  const activeCall = useActiveCall();

  // Handler executed when the call is hung up.
  const onHangupCall = () => {
    console.log('Call Hanged up');
  };

  // Handler executed when the call participants icon is clicked. This is used to render CallParticipantsInfoView.
  const onOpenCallParticipantsInfoViewHandler = () => {
    conole.log('Call Participants Info View');
  };

  // Since the call takes time to join we show an activityindicator until then.
  if (!activeCall) {
    return <ActivityIndicator size={'large'} style={StyleSheet.absoluteFill} />;
  }

  return (
    <ActiveCall
      onHangupCall={onHangupCall}
      onOpenCallParticipantsInfoView={onOpenCallParticipantsInfoViewHandler}
    />
  );
};
```

### Rendering the Incoming call view

To render the incoming call view, you can import `IncomingCallView` from the Video SDK and use it in the Screen/View where you want to render it. This component expects two handlers to deal with the case of what should happen when the call is accepted(`onAnswerCall`) or rejected(`onRejectCall`).

_Note: In our `react-native-call-starter-kit`, we use the handlers to navigate among screens._

```tsx
import React from 'react';
import { IncomingCallView } from '@stream-io/video-react-native-sdk';

const IncomingCallScreen = () => {
  // Handler executed when the call is answered
  const onAnswerCall = () => {
    console.log('Call Answered');
  };

  // Handler executed when the call is rejected
  const onRejectCall = () => {
    console.log('Call Rejected');
  };

  return (
    <IncomingCallView onAnswerCall={onAnswerCall} onRejectCall={onRejectCall} />
  );
};

export default IncomingCallScreen;
```

### Rendering the Outgoing call view

To render the outgoing call view, you can import `OutgoingCallView` from the Video SDK and use it in the Screen/View where you want to render it. This component expects a handler to deal with the case of what happens when the call is hung up(`onHangupCall`).

```tsx
import React from 'react';
import {
  OutgoingCallView,
  useActiveCall,
} from '@stream-io/video-react-native-sdk';

const OutgoingCallScreen = ({ navigation }: Props) => {
  const activeCall = useActiveCall();

  // Handler executed when the call is hung up.
  const onHangupCall = () => {
    console.log('Call Hanged up');
  };

  return <OutgoingCallView onHangupCall={onHangupCall} />;
};

export default OutgoingCallScreen;
```
