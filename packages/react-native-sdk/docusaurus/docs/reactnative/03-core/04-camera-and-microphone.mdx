---
id: camera-and-microphone
title: Camera & Microphone
description: Docs on the media manager
---

:::warning
Write React Native Specifics

This documentation is for the beta version of the Stream Video SDK.
The SDK is subject to change.
:::

[//]: # (Handling audio and video devices in a web application means working with [`MediaStream`]&#40;https://developer.mozilla.org/en-US/docs/Web/API/MediaStream&#41;, [`MediaDeviceInfo`]&#40;https://developer.mozilla.org/en-US/docs/Web/API/MediaDeviceInfo&#41; and other WebRTC API objects. We did our best to hide this complexity inside the `MediaDevicesProvider`. The easiest way to set up the provider is by using the [`StreamCall`]&#40;../../ui-components/core/stream-call&#41;, but it's also possible to use the `MediaDevicesProvider` directly.)

[//]: # ()
[//]: # (## Camera management)

[//]: # ()
[//]: # (### Call settings)

[//]: # ()
[//]: # (The default state of the camera is determined by the call settings:)

[//]: # ()
[//]: # (```typescript)

[//]: # (const metadata = useCallMetadata&#40;&#41;;)

[//]: # ()
[//]: # (metadata?.settings?.video.camera_default_on;)

[//]: # (```)

[//]: # ()
[//]: # (### Start-stop camera)

[//]: # ()
[//]: # (```typescript)

[//]: # (const localParticipant = useLocalParticipant&#40;&#41;;)

[//]: # (const isVideoMute = !localParticipant?.publishedTracks.includes&#40;)

[//]: # (  SfuModels.TrackType.VIDEO,)

[//]: # (&#41;;)

[//]: # (const { toggleVideoMuteState } = useToggleVideoMuteState&#40;&#41;;)

[//]: # ()
[//]: # (console.log&#40;`Camera is ${isVideoMute ? 'off' : 'on'}`&#41;;)

[//]: # (toggleVideoMuteState&#40;&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### List and select devices)

[//]: # ()
[//]: # (```typescript)

[//]: # (const { selectedVideoDeviceId, switchDevice } = useMediaDevices&#40;&#41;;)

[//]: # (const videoDevices = useVideoDevices&#40;&#41;; // This will prompt for camera access)

[//]: # ()
[//]: # (console.log&#40;`Current device: ${selectedVideoDeviceId}`&#41;;)

[//]: # (console.log&#40;'Video devices: ', videoDevices&#41;;)

[//]: # (switchDevice&#40;'videoinput', '<device id>'&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### Lobby preview)

[//]: # ()
[//]: # (Here is how to setup a video preview displayed before joining the call:)

[//]: # ()
[//]: # (```typescript)

[//]: # (const [stream, setStream] = useState<MediaStream>&#40;&#41;;)

[//]: # (const {)

[//]: # (  selectedVideoDeviceId,)

[//]: # (  getVideoStream,)

[//]: # (  initialVideoState,)

[//]: # (  setInitialVideoState,)

[//]: # (} = useMediaDevices&#40;&#41;;)

[//]: # ()
[//]: # (const videoDevices = useVideoDevices&#40;&#41;;)

[//]: # ()
[//]: # (useEffect&#40;&#40;&#41; => {)

[//]: # (  if &#40;!initialVideoState.enabled&#41; return;)

[//]: # ()
[//]: # (  getVideoStream&#40;{ deviceId: selectedVideoDeviceId }&#41;)

[//]: # (    .then&#40;&#40;s&#41; => {)

[//]: # (      setStream&#40;&#40;previousStream&#41; => {)

[//]: # (        if &#40;previousStream&#41; {)

[//]: # (          disposeOfMediaStream&#40;previousStream&#41;;)

[//]: # (        })

[//]: # (        return s;)

[//]: # (      }&#41;;)

[//]: # (    }&#41;)

[//]: # (    .catch&#40;&#40;e&#41; =>)

[//]: # (      setInitialVideoState&#40;{)

[//]: # (        ...DEVICE_STATE.error,)

[//]: # (        message: &#40;e as Error&#41;.message,)

[//]: # (      }&#41;,)

[//]: # (    &#41;;)

[//]: # (  return &#40;&#41; => {)

[//]: # (    setStream&#40;undefined&#41;;)

[//]: # (  };)

[//]: # (}, [)

[//]: # (  initialVideoState,)

[//]: # (  getVideoStream,)

[//]: # (  selectedVideoDeviceId,)

[//]: # (  setInitialVideoState,)

[//]: # (  videoDevices.length,)

[//]: # (]&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### Client-side settings)

[//]: # ()
[//]: # (It's possible to preselect the camera device and its state. A potential use-case would be to apply the user's previous choices loaded from `localStorage`.)

[//]: # ()
[//]: # (```tsx)

[//]: # (export const App = &#40;&#41; => {)

[//]: # (  const call = /* ... */;)

[//]: # ()
[//]: # (  return &#40;)

[//]: # (    <StreamCall call={call} mediaDevicesProviderProps={{)

[//]: # (        initialVideoEnabled: true, // This will override the state from call settings)

[//]: # (        initialVideoInputDeviceId: '...')

[//]: # (    }}>)

[//]: # (      <MyUI />)

[//]: # (    </StreamCall>)

[//]: # (  &#41;;)

[//]: # (};)

[//]: # (```)

[//]: # ()
[//]: # (## Microphone management)

[//]: # ()
[//]: # (### Call settings)

[//]: # ()
[//]: # (The default state of the microphone is determined by the call settings:)

[//]: # ()
[//]: # (```typescript)

[//]: # (const metadata = useCallMetadata&#40;&#41;;)

[//]: # ()
[//]: # (metadata?.settings?.audio.mic_default_on;)

[//]: # (```)

[//]: # ()
[//]: # (### Start-stop microphone)

[//]: # ()
[//]: # (```typescript)

[//]: # (const localParticipant = useLocalParticipant&#40;&#41;;)

[//]: # (const isAudioMute = !localParticipant?.publishedTracks.includes&#40;)

[//]: # (  SfuModels.TrackType.AUDIO,)

[//]: # (&#41;;)

[//]: # ()
[//]: # (console.log&#40;`Mic is ${isAudioMute ? 'off' : 'on'}`&#41;;)

[//]: # (const { toggleAudioMuteState } = useToggleAudioMuteState&#40;&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### List and select devices)

[//]: # ()
[//]: # (```typescript)

[//]: # (const { selectedAudioInputDeviceId, switchDevice } = useMediaDevices&#40;&#41;;)

[//]: # (const audioInputDevices = useAudioInputDevices&#40;&#41;; // This will prompt for microphone access)

[//]: # ()
[//]: # (console.log&#40;`Current device: ${selectedAudioInputDeviceId}`&#41;;)

[//]: # (console.log&#40;'Audio devices: ', audioInputDevices&#41;;)

[//]: # (switchDevice&#40;'audioinput', '<device id>'&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### Client-side settings)

[//]: # ()
[//]: # (It's possible to preselect the microphone device and its state. A potential use-case would be to apply the user's previous choices loaded from `localStorage`.)

[//]: # ()
[//]: # (```tsx)

[//]: # (export const App = &#40;&#41; => {)

[//]: # (  const call = /* ... */;)

[//]: # ()
[//]: # (  return &#40;)

[//]: # (    <StreamCall call={call} mediaDevicesProviderProps={{)

[//]: # (        initialAudioEnabled: true, // This will override the state from call settings)

[//]: # (        initialAudioInputDeviceId: '...')

[//]: # (    }}>)

[//]: # (      <MyUI />)

[//]: # (    </StreamCall>)

[//]: # (  &#41;;)

[//]: # (};)

[//]: # (```)

[//]: # ()
[//]: # (## Speaker management)

[//]: # ()
[//]: # (### Browser support)

[//]: # ()
[//]: # (Selecting audio output device for the call [isn't supported by all browsers]&#40;https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/sinkId&#41;, this is how you can check the availability:)

[//]: # ()
[//]: # (```typescript)

[//]: # (const { isAudioOutputChangeSupported } = useMediaDevices&#40;&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### List and select devices)

[//]: # ()
[//]: # (```typescript)

[//]: # (const { selectedAudioOutputDeviceId, switchDevice } = useMediaDevices&#40;&#41;;)

[//]: # (const audioOutputDevices = useAudioOutputDevices&#40;&#41;; // This will prompt for microphone access)

[//]: # ()
[//]: # (console.log&#40;`Current device: ${selectedAudioOutputDeviceId}`&#41;;)

[//]: # (console.log&#40;'Audio output devices: ', audioOutputDevices&#41;;)

[//]: # (switchDevice&#40;'audiooutput', '<device id>'&#41;;)

[//]: # (```)

[//]: # ()
[//]: # (### Client-side settings)

[//]: # ()
[//]: # (It's possible to preselect the speaker device. A potential use-case would be to apply the user's previous choices loaded from `localStorage`.)

[//]: # ()
[//]: # (```tsx)

[//]: # (export const App = &#40;&#41; => {)

[//]: # (  const call = /* ... */;)

[//]: # ()
[//]: # (  return &#40;)

[//]: # (    <StreamCall call={call} mediaDevicesProviderProps={{)

[//]: # (        initialAudioOutputDeviceId: '...')

[//]: # (    }}>)

[//]: # (      <MyUI />)

[//]: # (    </StreamCall>)

[//]: # (  &#41;;)

[//]: # (};)

[//]: # (```)

[//]: # ()
[//]: # (## Advanced)

[//]: # ()
[//]: # (### Device unavailability)

[//]: # ()
[//]: # (It may happen, that we would like to react to a situation, when there is no device of a given kind &#40;audio, video&#41; available. This can for example happen, when a laptop lid is closed. In that case we may want to disable the given device kind for the next time, when the lid is re-opened. That would for example lead to respecting user privacy with video being turned-off, even though before closing the lid it was turned on. The SDK provides the following hooks that will execute a callback when all the devices of a given kind are disconnected:)

[//]: # ()
[//]: # (- `useOnUnavailableVideoDevices`)

[//]: # (- `useOnUnavailableAudioInputDevices`)

[//]: # (- `useOnUnavailableAudioOutputDevices`)

[//]: # ()
[//]: # (:::info)

[//]: # (The `useOnUnavailableVideoDevices` hook is used in a pre-build component [`VideoPreview`]&#40;../../ui-components/participants/video-preview&#41;. Even after video device reconnection, the video preview is not restarted automatically and has to be enabled back manually by a user.)

[//]: # (:::)

[//]: # ()
[//]: # (### Sound detection)

[//]: # ()
[//]: # (An important topic related to media devices management is sound detection. A feature often needed in a call scenario &#40;volume detection, speaking-while-muted notification&#41;. We can start detecting the audio input level changes using the utility function [`createSoundDetector`]&#40;https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts&#41;. The function requires an instance of [`MediaStream`]&#40;https://developer.mozilla.org/en-US/docs/Web/API/MediaStream&#41; object of type `audioinput` and attaches sound analysers to it. The `MediaStream` can be retrieved by the SDK's `getAudioStream` utility function. Then it periodically collects audio frequency data. We can access this data by providing the `onSoundDetectedStateChanged` callback function. The callback function will be passed and object of type [`SoundDetectorState`]&#40;https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts&#41; as argument. From the object we can extract the information about the audio level &#40;`audioLevel`&#41; or a more simplified general flag that tells us, whether sound was detected &#40;`isSoundDetected`&#41;.)

[//]: # ()
[//]: # (It is also possible to configure the data collection algorithm with the third [`options` parameter]&#40;https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts&#41;.)

[//]: # ()
[//]: # (The return value of [`createSoundDetector`]&#40;https://github.com/GetStream/stream-video-js/tree/main/packages/client/src/helpers/sound-detector.ts&#41; function is a clean-up function that should be called, when a component, that uses sound detection is unmounted.)
