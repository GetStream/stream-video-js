---
id: 12-running-calls-in-background
title: Running Calls in Background
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ImageShowcase from '@site/src/components/ImageShowcase';
import iosInfoPlist from '../assets/ios-info-plist.png'

A natural expected behavior during a call is to keep being on the call even when the app goes to the background. In this guide, we explain how to achieve this in iOS and Android.

<Tabs
  defaultValue='android'
  values={[
    { label: 'Android', value: 'android' },
    { label: 'iOS', value: 'ios' },
  ]}
>
<TabItem value='android'>

In Android, when the app goes to the background, we can run a foreground service to keep the call alive. This ensures that both the video stream and audio stream are kept alive while the app goes into the background.

We can start a foreground service using the [notifee library](https://notifee.app/).

#### Install notifee

<Tabs groupId="package-manager">
  <TabItem value="Yarn" default>

```bash
  yarn add @notifee/react-native
  npx pod-install
```

  </TabItem>
  <TabItem value="npm">

```bash
  npm install @notifee/react-native
  npx pod-install
```
  </TabItem>
    </Tabs>

#### Configure the foreground service

Add the following entry to your `AndroidManifest.xml`

```xml
    <service
      android:name="app.notifee.core.ForegroundService"
      android:foregroundServiceType="camera|microphone" />
```

Add the following function in your codebase to start a foreground service and to keep the call alive.

```ts
import notifee, { AndroidImportance } from '@notifee/react-native';

const FOREGROUND_SERVICE_CHANNEL_ID = 'call_foreground_service';

async function setForegroundService() {
  try {
    await notifee.createChannel({
      id: FOREGROUND_SERVICE_CHANNEL_ID,
      name: 'Stream Call',
      lights: false,
      vibration: false,
      importance: AndroidImportance.DEFAULT,
    });
    notifee.registerForegroundService(() => {
      return new Promise(() => {
        console.log('Foreground service running for call in progress');
      });
    });
  } catch (err) {
    // Handle Error
  }
}

// call this in the entry point of your app (index.js or equivalent)
if (Platform.OS === 'android') {
  setForegroundService();
}
```

#### Setup the active call screen to start the foreground service whenever the call is alive

The following is an example implementation of the screen that shows the active call. It is set up to start the foreground service whenever the call is alive and stop it whenever the call is ended.

```ts
import notifee from '@notifee/react-native';
import {
  ActiveCall,
  useActiveCall,
} from '@stream-io/video-react-native-sdk';

export const CallScreen = ({ route, navigation }: Props) => {
  const activeCall = useActiveCall();

  useEffect(() => {
    if (!activeCall) {
      return;
    }
    notifee.displayNotification({
        title: 'Call in progress',
        body: 'Tap to return to the call',
        android: {
            channelId: FOREGROUND_SERVICE_CHANNEL_ID,
            asForegroundService: true,
            pressAction: {
                id: 'default',
                launchActivity: 'default',
            },
        },
    });
    return () => {
      notifee.stopForegroundService();
    };
  }, [activeCall]);

  const onCallHungUpHandler = () => {
    navigation.navigate('JoinCallScreen');
  };

  const onOpenCallParticipantsInfoViewHandler = () => {
    navigation.navigate('CallParticipantsInfoScreen');
  };

  if (!activeCall) {
    return <ActivityIndicator size={'large'} style={StyleSheet.absoluteFill} />;
  }
  return (
    <ActiveCall
      onCallHungUp={onCallHungUpHandler}
      onOpenCallParticipantsInfoView={onOpenCallParticipantsInfoViewHandler}
    />
  );
};
```
</TabItem>
<TabItem value='ios'>

In iOS, enabling Voice Over IP (VoIP) background mode will ensure that the call is alive even when the app goes to the background. This ensures that the audio stream is kept alive while being in the background.

:::info
When app goes to background the video stream cannot be kept alive in iOS. This is different from Android. However, when the app comes back to the foreground the video stream will be republished again.
:::


In Xcode: Open `Info.plist` file and add `voip` in `UIBackgroundModes`. As shown below:

<ImageShowcase
  items={[
    {
      image: iosInfoPlist,
      alt: 'Example of how to add voip in Info.plist',
    }
  ]}
/>

By editing this file with a text editor, you should see:

```xml
<key>UIBackgroundModes</key>
<array>
  <string>voip</string>
</array>
```
</TabItem>
</Tabs>
